(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{559:function(e,t,n){Promise.resolve().then(n.bind(n,5003))},5003:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var r=n(4033),a=n(7727),o=n(2265);function l(){let e=(0,r.useRouter)(),{user:t}=(0,a.a)();return(0,o.useEffect)(()=>{t?e.push("/user/home"):e.push("/login")},[t]),null}},8096:function(e,t,n){"use strict";var r=n(2698);let a=r.Z.create({baseURL:"http://localhost:3001/api",headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{let t=localStorage.getItem("auth_token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),a.interceptors.response.use(e=>e,async e=>{var t;if((null===(t=e.response)||void 0===t?void 0:t.status)===401){localStorage.removeItem("auth_token");let e=window.location.pathname;"/login"!==e&&"/"!==e&&(window.location.href="/login")}return Promise.reject(e)}),t.Z=a},7727:function(e,t,n){"use strict";n.d(t,{a:function(){return g}});var r,a=n(2265);let o=e=>{let t;let n=new Set,r=(e,r)=>{let a="function"==typeof e?e(t):e;if(!Object.is(a,t)){let e=t;t=(null!=r?r:"object"!=typeof a||null===a)?a:Object.assign({},t,a),n.forEach(n=>n(t,e))}},a=()=>t,o={setState:r,getState:a,getInitialState:()=>l,subscribe:e=>(n.add(e),()=>n.delete(e))},l=t=e(r,a,o);return o},l=e=>e?o(e):o,i=e=>e,u=e=>{let t=l(e),n=e=>(function(e,t=i){let n=a.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return a.useDebugValue(n),n})(t,e);return Object.assign(n,t),n};var s=n(8096);let c=e=>["お試し","退会者","初伝","中伝","奥伝","皆伝","管理者"].includes(e),d=e=>{if(!e.rank||!c(e.rank))throw Error("Invalid user rank");return{id:e.id,email:e.email,name:e.name,rank:e.rank,mongoId:e.mongoId}},g=(r=e=>({user:null,loading:!1,error:null,initialized:!1,login:async(t,n)=>{e({loading:!0,error:null});try{let r;r=n?await s.Z.post("/auth/login",{email:t,password:n}):await s.Z.get("/auth/verify",{headers:{Authorization:"Bearer ".concat(t)}});let{success:a,token:o,user:l}=r.data;if(a&&o&&l){let t=d(l);return localStorage.setItem("auth_token",o),e({user:t,loading:!1,error:null}),!0}return e({error:r.data.message||"認証に失敗しました",loading:!1}),!1}catch(t){return localStorage.removeItem("auth_token"),e({user:null,error:"認証に失敗しました",loading:!1}),!1}},logout:()=>{localStorage.removeItem("auth_token"),e({user:null,loading:!1,error:null})},setInitialized:t=>e({initialized:t})}))?u(r):u},4033:function(e,t,n){e.exports=n(8165)}},function(e){e.O(0,[829,971,596,744],function(){return e(e.s=559)}),_N_E=e.O()}]);