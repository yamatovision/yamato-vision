(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[674],{6346:function(e,t,s){Promise.resolve().then(s.bind(s,1671))},1671:function(e,t,s){"use strict";s.r(t),s.d(t,{UserList:function(){return c}});var r=s(7437),a=s(2265);function n(e){let{userId:t,currentStatus:s,onUpdate:n}=e,[l,i]=(0,a.useState)(!1),[c,d]=(0,a.useState)("gems"),[o,u]=(0,a.useState)(0),[x,m]=(0,a.useState)([]),[p,h]=(0,a.useState)(""),[g,y]=(0,a.useState)(!1),b=async()=>{if("badges"===c&&0===x.length)try{let e=await fetch("/api/badges"),t=await e.json();t.success&&m(t.data)}catch(e){console.error("Failed to fetch badges:",e)}},f=async()=>{if(!(o<=0)){y(!0);try{let e=await fetch("/api/users/admin/users/".concat(t,"/gems"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:o})});if(!e.ok)throw Error("Failed to grant gems");n(),i(!1),u(0)}catch(e){console.error("Error granting gems:",e)}finally{y(!1)}}},j=async()=>{if(p){y(!0);try{let e=await fetch("/api/users/admin/users/".concat(t,"/badges"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({badgeId:p})});if(!e.ok)throw Error("Failed to grant badge");n(),i(!1),h("")}catch(e){console.error("Error granting badge:",e)}finally{y(!1)}}},v=async()=>{y(!0);try{let e=await fetch("/api/users/admin/users/".concat(t,"/penalty"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({isPenalty:"PENALTY"!==s})});if(!e.ok)throw Error("Failed to toggle penalty");n(),i(!1)}catch(e){console.error("Error toggling penalty:",e)}finally{y(!1)}};return l?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[(0,r.jsxs)("div",{className:"p-4 border-b",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-[#2C3E50]",children:"ユーザー操作"}),(0,r.jsx)("button",{onClick:()=>i(!1),className:"text-gray-400 hover:text-gray-500",children:"✕"})]}),(0,r.jsxs)("div",{className:"flex space-x-4 mt-4",children:[(0,r.jsx)("button",{onClick:()=>d("gems"),className:"px-4 py-2 rounded-md ".concat("gems"===c?"bg-blue-50 text-blue-600":"text-gray-600 hover:bg-gray-50"),children:"ジェム付与"}),(0,r.jsx)("button",{onClick:()=>d("badges"),className:"px-4 py-2 rounded-md ".concat("badges"===c?"bg-blue-50 text-blue-600":"text-gray-600 hover:bg-gray-50"),children:"バッジ付与"}),(0,r.jsx)("button",{onClick:()=>d("penalty"),className:"px-4 py-2 rounded-md ".concat("penalty"===c?"bg-blue-50 text-blue-600":"text-gray-600 hover:bg-gray-50"),children:"ペナルティ"})]})]}),(0,r.jsxs)("div",{className:"p-4",children:["gems"===c&&(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"付与するジェム数"}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("input",{type:"number",value:o,onChange:e=>u(Number(e.target.value)),className:"flex-1 rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ジェム数を入力",min:"0"}),(0,r.jsx)("button",{onClick:f,disabled:g||o<=0,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:"付与"})]})]})}),"badges"===c&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"grid grid-cols-3 gap-3",children:x.map(e=>(0,r.jsxs)("div",{onClick:()=>h(e.id),className:"p-2 border rounded-lg cursor-pointer ".concat(p===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300"),children:[(0,r.jsx)("img",{src:e.iconUrl,alt:e.title,className:"w-full aspect-square rounded-lg object-cover"}),(0,r.jsx)("div",{className:"mt-1 text-xs text-center font-medium text-gray-700",children:e.title})]},e.id))}),(0,r.jsx)("button",{onClick:j,disabled:g||!p,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:"バッジを付与"})]}),"penalty"===c&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"PENALTY"===s?"ペナルティを解除しますか？":"ペナルティを設定しますか？"}),(0,r.jsx)("button",{onClick:v,disabled:g,className:"w-full px-4 py-2 rounded-md ".concat("PENALTY"===s?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"," text-white disabled:opacity-50"),children:"PENALTY"===s?"ペナルティを解除":"ペナルティを設定"})]})]})]})}):(0,r.jsx)("button",{onClick:()=>{i(!0),b()},className:"text-[#4A90E2] hover:text-[#357ABD] font-medium",children:"操作"})}function l(e){let{value:t,onChange:s}=e;return(0,r.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[(0,r.jsxs)("div",{className:"flex-1 relative",children:[(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,r.jsx)("svg",{className:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})}),(0,r.jsx)("input",{type:"text",value:t.query,onChange:e=>{s({...t,query:e.target.value})},placeholder:"".concat("name"===t.searchBy?"名前":"メールアドレス","で検索..."),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsx)("div",{className:"sm:w-48",children:(0,r.jsxs)("select",{value:t.searchBy,onChange:e=>{s({...t,searchBy:e.target.value})},className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white",children:[(0,r.jsx)("option",{value:"name",children:"名前で検索"}),(0,r.jsx)("option",{value:"email",children:"メールアドレスで検索"})]})}),t.query&&(0,r.jsx)("button",{onClick:()=>s({...t,query:""}),className:"px-4 py-2 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"クリア"})]})})}var i=s(8096);function c(){let[e,t]=(0,a.useState)([]),[s,c]=(0,a.useState)(!0),[d,o]=(0,a.useState)({query:"",searchBy:"name"}),[u,x]=(0,a.useState)({field:"createdAt",order:"desc"}),[m,p]=(0,a.useState)(1),[h,g]=(0,a.useState)(1);(0,a.useEffect)(()=>{y()},[m,d,u]);let y=async()=>{try{c(!0);let e=await i.Z.get("/users/admin/users",{params:{page:m,search:d.query,searchBy:d.searchBy,sortBy:u.field,order:u.order}});e.data.success&&(t(e.data.data.users),g(e.data.data.pagination.totalPages))}catch(e){console.error("Failed to fetch users:",e)}finally{c(!1)}},b=e=>{x(t=>({field:e,order:t.field===e&&"asc"===t.order?"desc":"asc"}))},f=()=>{y()};return s?(0,r.jsx)("div",{className:"flex justify-center p-8",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#4A90E2]"})}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(l,{value:d,onChange:e=>{o(e),p(1)}}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{onClick:()=>b("name"),className:"px-6 py-3 text-left text-xs font-medium text-[#707F8C] uppercase tracking-wider cursor-pointer",children:"ユーザー名"}),(0,r.jsx)("th",{onClick:()=>b("email"),className:"px-6 py-3 text-left text-xs font-medium text-[#707F8C] uppercase tracking-wider cursor-pointer",children:"メールアドレス"}),(0,r.jsx)("th",{onClick:()=>b("rank"),className:"px-6 py-3 text-left text-xs font-medium text-[#707F8C] uppercase tracking-wider cursor-pointer",children:"階級"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-[#707F8C] uppercase tracking-wider",children:"ジェム"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-[#707F8C] uppercase tracking-wider",children:"バッジ"}),(0,r.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-[#707F8C] uppercase tracking-wider",children:"操作"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.name}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.email}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ".concat("PENALTY"===e.status?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:e.rank})}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.gems," \uD83D\uDC8E"]}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex -space-x-2",children:[e.badges.slice(0,3).map(e=>(0,r.jsx)("img",{src:e.iconUrl,alt:e.title,className:"w-8 h-8 rounded-full border-2 border-white"},e.id)),e.badges.length>3&&(0,r.jsxs)("span",{className:"ml-2 text-sm text-gray-500",children:["+",e.badges.length-3]})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,r.jsx)(n,{userId:e.id,currentStatus:e.status,onUpdate:f})})]},e.id))})]}),(0,r.jsx)("div",{className:"px-6 py-4 flex items-center justify-between border-t border-gray-200",children:(0,r.jsxs)("div",{className:"flex-1 flex justify-between sm:hidden",children:[(0,r.jsx)("button",{onClick:()=>p(e=>Math.max(1,e-1)),disabled:1===m,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"前へ"}),(0,r.jsx)("button",{onClick:()=>p(e=>Math.min(h,e+1)),disabled:m===h,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"次へ"})]})})]})]})}},8096:function(e,t,s){"use strict";var r=s(2698);let a=r.Z.create({baseURL:"http://localhost:3001/api",headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{let t=localStorage.getItem("auth_token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),a.interceptors.response.use(e=>e,async e=>{var t;if((null===(t=e.response)||void 0===t?void 0:t.status)===401){localStorage.removeItem("auth_token");let e=window.location.pathname;"/login"!==e&&"/"!==e&&(window.location.href="/login")}return Promise.reject(e)}),t.Z=a},622:function(e,t,s){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=s(2265),a=Symbol.for("react.element"),n=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,i=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,s){var r,n={},d=null,o=null;for(r in void 0!==s&&(d=""+s),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(o=t.ref),t)l.call(t,r)&&!c.hasOwnProperty(r)&&(n[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===n[r]&&(n[r]=t[r]);return{$$typeof:a,type:e,key:d,ref:o,props:n,_owner:i.current}}t.Fragment=n,t.jsx=d,t.jsxs=d},7437:function(e,t,s){"use strict";e.exports=s(622)}},function(e){e.O(0,[829,971,596,744],function(){return e(e.s=6346)}),_N_E=e.O()}]);