(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{6388:function(e,t,r){Promise.resolve().then(r.bind(r,2237))},2237:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return d}});var a=r(7437),n=r(4033),s=r(7727),i=r(2265);let o="https://yamatovision-blue-lamp.web.app";function l(e){let{redirectUrl:t}=e,[r,l]=(0,i.useState)(""),[d,c]=(0,i.useState)(""),[u,m]=(0,i.useState)(!1),[x,h]=(0,i.useState)(null),g=(0,n.useRouter)(),{login:f}=(0,s.a)();(0,i.useEffect)(()=>{let e=async e=>{if(e.origin===o){let{type:r,token:a,timestamp:n}=e.data;if("AUTH_TOKEN"===r)try{m(!0);let e=await f(a);e&&g.push(t)}catch(e){h("認証に失敗しました。"),console.error("認証エラー:",e)}finally{m(!1)}}};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[g,f,t]);let p=async e=>{e.preventDefault(),m(!0),h(null);try{let e=await f(r,d);e&&g.push(t)}catch(e){h("ログインに失敗しました。メールアドレスとパスワードをご確認ください。")}finally{m(!1)}};return(0,a.jsx)("div",{className:"max-w-md mx-auto",children:(0,a.jsx)("div",{className:"bg-white py-8 px-6 shadow rounded-lg sm:px-10",children:(0,a.jsxs)("form",{className:"mb-0 space-y-6",onSubmit:p,children:[x&&(0,a.jsx)("div",{className:"rounded-md bg-red-50 p-4",children:(0,a.jsx)("div",{className:"text-sm text-red-700",children:x})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"メールアドレス"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("input",{id:"email",name:"email",type:"email",required:!0,value:r,onChange:e=>l(e.target.value),placeholder:"メールアドレスを入力してください",className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"パスワード"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("input",{id:"password",name:"password",required:!0,type:"password",value:d,onChange:e=>c(e.target.value),placeholder:"パスワードを入力してください",className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("button",{type:"submit",disabled:u,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-indigo-400",children:u?"ログイン中...":"ログイン"}),(0,a.jsx)("div",{className:"mt-4 text-center",children:(0,a.jsx)("a",{href:"".concat(o,"/password/reset?source=yamatovision&redirect=").concat(encodeURIComponent(window.location.origin)),className:"text-sm text-indigo-600 hover:text-indigo-800 hover:underline",children:"パスワードをお忘れの方はこちら"})})]})]})})})}function d(){var e;let t=(0,n.useSearchParams)(),{loading:r}=(0,s.a)(),i=null!==(e=null==t?void 0:t.get("redirect"))&&void 0!==e?e:"/user/home";return r?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):(0,a.jsx)("main",{className:"min-h-screen bg-gray-50",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"pt-16 pb-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-4xl tracking-tight font-extrabold text-gray-900 sm:text-5xl md:text-6xl",children:(0,a.jsx)("span",{className:"block",children:"大和Vision"})}),(0,a.jsx)("p",{className:"mt-3 max-w-md mx-auto text-base text-gray-500 sm:text-lg md:mt-5 md:text-xl md:max-w-3xl",children:"アカウントでログインしてください"})]})}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)(l,{redirectUrl:i})})]})})})}},8096:function(e,t,r){"use strict";var a=r(2698);let n=a.Z.create({baseURL:"http://localhost:3001/api",headers:{"Content-Type":"application/json"}});n.interceptors.request.use(e=>{let t=localStorage.getItem("auth_token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),n.interceptors.response.use(e=>e,async e=>{var t;if((null===(t=e.response)||void 0===t?void 0:t.status)===401){localStorage.removeItem("auth_token");let e=window.location.pathname;"/login"!==e&&"/"!==e&&(window.location.href="/login")}return Promise.reject(e)}),t.Z=n},7727:function(e,t,r){"use strict";r.d(t,{a:function(){return m}});var a,n=r(2265);let s=e=>{let t;let r=new Set,a=(e,a)=>{let n="function"==typeof e?e(t):e;if(!Object.is(n,t)){let e=t;t=(null!=a?a:"object"!=typeof n||null===n)?n:Object.assign({},t,n),r.forEach(r=>r(t,e))}},n=()=>t,s={setState:a,getState:n,getInitialState:()=>i,subscribe:e=>(r.add(e),()=>r.delete(e))},i=t=e(a,n,s);return s},i=e=>e?s(e):s,o=e=>e,l=e=>{let t=i(e),r=e=>(function(e,t=o){let r=n.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return n.useDebugValue(r),r})(t,e);return Object.assign(r,t),r};var d=r(8096);let c=e=>["お試し","退会者","初伝","中伝","奥伝","皆伝","管理者"].includes(e),u=e=>{if(!e.rank||!c(e.rank))throw Error("Invalid user rank");return{id:e.id,email:e.email,name:e.name,rank:e.rank,mongoId:e.mongoId}},m=(a=e=>({user:null,loading:!1,error:null,initialized:!1,login:async(t,r)=>{e({loading:!0,error:null});try{let a;a=r?await d.Z.post("/auth/login",{email:t,password:r}):await d.Z.get("/auth/verify",{headers:{Authorization:"Bearer ".concat(t)}});let{success:n,token:s,user:i}=a.data;if(n&&s&&i){let t=u(i);return localStorage.setItem("auth_token",s),e({user:t,loading:!1,error:null}),!0}return e({error:a.data.message||"認証に失敗しました",loading:!1}),!1}catch(t){return localStorage.removeItem("auth_token"),e({user:null,error:"認証に失敗しました",loading:!1}),!1}},logout:()=>{localStorage.removeItem("auth_token"),e({user:null,loading:!1,error:null})},setInitialized:t=>e({initialized:t})}))?l(a):l},622:function(e,t,r){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var a=r(2265),n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,r){var a,s={},d=null,c=null;for(a in void 0!==r&&(d=""+r),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(c=t.ref),t)i.call(t,a)&&!l.hasOwnProperty(a)&&(s[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===s[a]&&(s[a]=t[a]);return{$$typeof:n,type:e,key:d,ref:c,props:s,_owner:o.current}}t.Fragment=s,t.jsx=d,t.jsxs=d},7437:function(e,t,r){"use strict";e.exports=r(622)},4033:function(e,t,r){e.exports=r(8165)}},function(e){e.O(0,[829,971,596,744],function(){return e(e.s=6388)}),_N_E=e.O()}]);